<config>

    <service name="default" alias="{{ mp_server_conf }}"/>

    <!-- ############################################################################## -->

    <service name="mysql-mp-server-config" address="https://{{ inventory_hostname }}/{{ mp_server }}" debug="true">

       <logging  logFileName="{{ mp_server_log_dir }}/{{ mp_server }}.log"
                 logName="MP"
                 logSize="1000000"
                 logFileCount="10"
                 debug="true"
       />

       <scopes handler="org.masterportal.oauth2.server.MPForwardingScopeHandler">
	  <scope>org.cilogon.userinfo</scope>
       </scopes>

       <mysql    username="{{ mp_server_db_user }}" 
                 password="{{ mp_server_db_pw }}" 
                 database="{{ mp_server_db }}" 
                 schema="{{ mp_server_db }}" >
                         <transactions/>
                         <clients/>
                         <clientApprovals/>
       </mysql>

       <myproxy host="{{ credstore_host }}" port="{{ credstore_port }}" password="{{ credstore_pw }}">
                 <keystore path="{{ mp_server_keystore }}"
                           type="pkcs12"
                           password="{{ mp_server_keystore_pw }}"
                           factory="SunX509" />
		 <!-- 
			The default lifetime set in seconds is used in case there is no proxylifetime value 
			provided with the original /getproxy request 
		 -->
		 <defaultLifetime>43200</defaultLifetime>
		 <!-- 
			The maximum lifetime value should be the max_proxy_lifetime - tolerance, where the 
			max_proxy_lifetime is set in the myproxy-server.conf (converted into seconds), and
			the tolerance is a small timeframe (usually a day) which prevents the Delegation
			Server from being flooded with requests.
		 -->
		 <maximumLifetime>864000</maximumLifetime>
       </myproxy>

       <!-- <authorizationServlet useHeader="true" requireHeader="true" headerFieldName="eppn" /> -->

    </service>

    <!-- ############################################################################## -->

    <service name="filestore-mp-server-config" address="https://{{ inventory_hostname }}/{{ mp_server }}" debug="true">

       <logging  logFileName="{{ mp_server_log_dir }}/{{ mp_server }}.log"
                 logName="MP"
                 logSize="1000000"
                 logFileCount="10"
                 debug="true"
       />

       <scopes handler="org.masterportal.oauth2.server.MPForwardingScopeHandler">
	  <scope>org.cilogon.userinfo</scope>
       </scopes>

       <fileStore path="{{ mp_server_storage_dir }}">
               <transactions/>
               <clients/>
               <clientApprovals/>
       </fileStore>

       <myproxy host="{{ credstore_host }}" port="{{ credstore_port }}" password="{{ credstore_pw }}">
                 <keystore path="{{ mp_server_keystore }}"
                           type="pkcs12"
                           password="{{ mp_server_keystore_pw }}"
                           factory="SunX509" />
       </myproxy>

       <!-- <authorizationServlet useHeader="true" requireHeader="true" headerFieldName="eppn" /> -->

    </service>

</config>

